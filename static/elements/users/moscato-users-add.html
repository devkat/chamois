<dom-module id="moscato-users-add">
  <style>
    form {
      @apply(--layout-vertical);
    }
    .buttons {
      margin-top: 1em;
      @apply(--layout-horizontal);
    }
  </style>
  <template>
    <section id="moscato-users-add" data-route="users-add">
      <h2>Add user</h2>
      <form is="iron-form">
        <paper-input-container>
          <label>Username</label>
          <input is="iron-input" id="username" value="{{username}}" type="text" required>
        </paper-input-container>
        <paper-input-container>
          <label>E-mail</label>
          <input is="iron-input" id="email" value="{{email}}" type="email" required>
          <paper-input-error>Invalid e-mail address</paper-input-error>
        </paper-input-container>
        <div class="buttons">
          <paper-button raised on-click="addUserAction">Add</paper-button></paper-button>
        </div>
      </form>
    </section>
  </template>
  <script>
    (function() {
      Polymer({
        
        properties: {
          users: {
            type: Array,
            value: [],
            notify: true
          }
        },

        addUserAction: function() {
          var valid = this.$.email.validate();
          if (valid) {
            var that = this;
            restStore.add('users', {
              username: this.$.username.value,
              email: this.$.email.value
            }).done(function() {
              // when polyfilling Object.observe, make sure we update immediately
              Polymer.dom.flush();
              that.$.username.value = '';
              that.$.email.value = '';
              page.redirect('/users');
            });
          }
        },
        
        cancelAddUserAction: function() {
          this.$.username.value = '';
          this.$.email.value = '';
        }
        
      });
    })();
  </script>
</dom-module>
